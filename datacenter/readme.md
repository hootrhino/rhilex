# 技术提案：边缘网关本地数据存储系统
![1714196948398](image/readme/1714196948398.png)
## 1. 引言
随着工业物联网和边缘计算的快速发展，边缘网关在数据采集和处理中扮演着越来越重要的角色。为了提高数据处理效率和系统的可靠性，我们提议在边缘网关上开发一套本地数据存储系统。本提案旨在详细说明系统的设计、功能、优势以及实施计划。
## 2. 系统设计
### 2.1 系统架构
系统的核心架构包括三个主要部分：数据采集模块、数据存储模块和数据管理模块。
1. **数据采集模块**：负责从各种传感器和设备中采集数据。
2. **数据存储模块**：将采集到的数据存储在边缘网关的本地存储系统中。
3. **数据管理模块**：提供数据的查询、分析和维护功能。
### 2.2 技术选型
- **数据存储**：SQLite
- **数据同步**：通过MQTT或TCP实现与云服务或其他边缘设备的数据同步。
## 3.数据来源
首先在数据模型里面建立一个模型，然后新增各类字段，最后发布这个模型，发乎以后这个模型便会被同步成一个表，而数据中心里面的数据就来自该表。用户层面测查询接口均来自于此。

## 数据接口
### 存储接口
Lua的存储接口如下：
```lua
function Main(arg)
    for i = 1, 10, 1 do
        local err = rds:Save('SCHEMAAAEM8PHB', {
            -- 字段
        })
        if err ~= nil then
            Throw(err)
            return 0
        end
    end
    return 0
end

```
注意：字段是数据模型的属性名称。

### 历史数据
```sh
curl --location --request GET 'http://192.168.1.185:2580/api/v1/datacenter/queryDataList?uuid=SCHEMAAAEM8PHB&current=1&size=10&order=DESC' \
--header 'User-Agent: localhost'
```
### 最新数据
```sh
curl --location --request GET 'http://192.168.1.185:2580/api/v1/datacenter/queryLastData?uuid=SCHEMAZ848ZRDG' \
--header 'User-Agent: localhost'
```

## 数据存储机制
RHILEX默认保存7天内数据，每天会有计时器自动清除计划之外的数据。下面是配置保存的时间周期：
- `-7 day`：表示当前日期减去7天。
- `-1 month`：表示当前日期减去1个月。
- `-1 year`：表示当前日期减去1年。
- `-1 hour`：表示当前日期减去1小时。
- `-1 minute`：表示当前日期减去1分钟。
- `-1 second`：表示当前日期减去1秒。
这些参数可以组合使用，例如`-7 day -1 month`表示当前日期减去7天和1个月。您也可以使用`+`符号来表示未来的时间偏移量。
此外，SQLite还支持其他日期和时间函数，如`datetime('now', '-7 day')`，它返回当前日期和时间减去7天的值。这些函数可以根据您的具体需求进行组合，以获取所需的时间点。

## 注意事项
数据中心和配置用的不是同一个数据库。API接口也不一样。